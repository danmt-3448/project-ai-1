// PostgreSQL variant of the schema for deploying to Neon
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id       String    @id @default(cuid())
  name     String
  slug     String    @unique
  products Product[]

  @@map("categories")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  price       Float
  inventory   Int      @default(0)
  published   Boolean  @default(false)
  images      String   @default("[]")
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([categoryId])
  @@index([published])
  @@index([slug])
  @@map("products")
}

model Order {
  id                 String          @id @default(cuid())
  buyerName          String
  buyerEmail         String
  address            String
  total              Float
  status             String          @default("PENDING") // PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED, CONFIRMED, FAILED
  items              OrderItem[]
  activities         OrderActivity[]
  // Shipping tracking fields
  trackingNumber     String?
  carrier            String?
  shipDate           DateTime?
  deliveryDate       DateTime?
  // Cancellation tracking
  cancellationReason String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @default(now()) @updatedAt

  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

model OrderItem {
  id        String @id @default(cuid())
  order     Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String
  productId String
  name      String
  price     Float
  quantity  Int

  @@index([orderId])
  @@map("order_items")
}

model OrderActivity {
  id         String    @id @default(cuid())
  order      Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId    String
  admin      AdminUser @relation(fields: [adminId], references: [id])
  adminId    String
  fromStatus String
  toStatus   String
  note       String?
  timestamp  DateTime  @default(now())

  @@index([orderId])
  @@index([timestamp])
  @@map("order_activities")
}

model AdminUser {
  id         String          @id @default(cuid())
  username   String          @unique
  password   String // bcrypt hashed
  activities OrderActivity[]

  @@map("admin_users")
}
